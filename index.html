<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NammaRide </title>

    <meta name="description" content="Minimalist guide to the Bengaluru Metro. Plan your journey and track live routes.">
    <meta name="theme-color" content="#1E3A8A">
    <link rel="icon" type="image/png" href="https://placehold.co/32x32/1E3A8A/FFFFFF?text=üöá">
    <link rel="manifest" href="manifest.json">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            --primary-color: #4F46E5; 
            --background-color: #0F172A; 
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--background-color); 
            
            background-image: url('./vidhan bengaluru.jpg'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background-color: rgba(15, 23, 42, 0.95); 
            z-index: -1;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(79, 148, 205, 0.6); border-radius: 2px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(79, 70, 229, 0.8); }
        
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .route-line { width: 2px; position: absolute; left: 10px; top: 0; bottom: 0; z-index: 0; }
        #train-marker { transition: top 0.5s linear; }
        .station-pulse { animation: pulse 1s ease-out; }
        @keyframes pulse { 
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
            50% { transform: scale(1.2); box-shadow: 0 0 5px 10px rgba(255, 255, 255, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
    </style>
</head>
<body class="text-gray-100">

    <div id="app-container" class="h-screen w-full flex flex-col items-center justify-center p-2 sm:p-4 selection:bg-indigo-500/30">
        
        <div class="bg-slate-900/95 w-full max-w-lg rounded-xl shadow-2xl shadow-black/50 flex flex-col h-full sm:h-auto relative overflow-hidden transition-all duration-300">

            <header class="p-4 border-b border-slate-700/60 bg-slate-900/80 backdrop-blur-sm">
                <div class="flex justify-between items-center mb-2">
                    <h1 class="text-xl font-bold text-gray-100 tracking-wider flex items-center gap-2">
                        
<img src="./logo.png" alt="Metro Mitra Logo" class="h-7 w-auto mr-1">
                        <i data-lucide="route" class="w-6 h-6 text-indigo-400"></i>
                        <span data-lang-key="appName">NammaRide</span>
                    </h1>
                    <p id="live-clock" class="text-sm text-gray-400 font-mono tracking-wider"></p>
                </div>
                <div class="flex justify-end">
                    <select id="language-selector" class="p-1.5 bg-slate-700/60 border border-slate-600 rounded-lg text-xs text-white">
                        <option value="en">English</option>
                        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                        <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
                    </select>
                </div>
            </header>

            <section id="planner-view" class="p-4 sm:p-6 flex flex-col transition-opacity duration-300">
                <h2 class="text-lg font-semibold mb-4 text-indigo-300" data-lang-key="planYourTrip">Plan Your Trip</h2>
                
                <div id="planner-controls" class="space-y-3 mb-4">
                    <div class="relative">
                        <i data-lucide="map-pin" class="absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-indigo-400"></i>
                        <select id="start-station" class="w-full pl-10 pr-4 py-3 bg-slate-700/80 border border-slate-600 focus:ring-2 focus:ring-indigo-500 rounded-lg appearance-none transition-all text-sm"></select>
                    </div>

                    <button id="swap-stations" class="w-full p-2 bg-slate-700/80 border border-slate-600 rounded-lg hover:bg-slate-600/50 transition-colors" title="Swap Stations">
                        <i data-lucide="arrow-down-up" class="w-4 h-4 text-gray-300 mx-auto"></i>
                    </button>
                    
                    <div class="relative">
                        <i data-lucide="flag" class="absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-green-400"></i>
                        <select id="end-station" class="w-full pl-10 pr-4 py-3 bg-slate-700/80 border border-slate-600 focus:ring-2 focus:ring-green-500 rounded-lg appearance-none transition-all text-sm"></select>
                    </div>
                </div>

                <div id="journey-summary-container" class="bg-slate-800/70 p-4 rounded-lg border border-slate-700/60 animate-fade-in">
                    <div id="journey-summary" class="text-center text-sm text-gray-400" data-lang-key="selectStationsHint">Select stations to see the fastest route.</div>
                </div>

                <div id="board-train-btn-container" class="my-4">
                    <button id="board-train-btn" class="hidden w-full bg-indigo-600 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-indigo-500 transition-all duration-300 flex items-center justify-center gap-2">
                        <i data-lucide="send" class="w-5 h-5"></i>
                        <span data-lang-key="startLiveJourney">Start Live Journey</span>
                    </button>
                    <p class="text-center text-xs text-gray-500 mt-2" data-lang-key="disclaimer">Disclaimer: Timings and fare are estimates, please confirm at stations.</p>
                </div>
                
                <div class="mt-4 pt-4 border-t border-slate-700/60 text-center text-xs space-y-1">
                    <p class="text-red-400 font-medium" data-lang-key="nonOfficialDisclaimer">This is not an official BMRCL website.</p>
                    <p class="text-gray-400" data-lang-key="feedbackPrompt">For feedback, use:</p>
                    <a href="mailto:feedback.lumina@gmail.com" class="text-indigo-400 hover:underline">feedback.lumina@gmail.com</a>
                </div>
                </section>
            
            <section id="map-view" class="hidden flex-grow overflow-y-auto custom-scrollbar p-4 sm:p-6 min-h-0 bg-slate-900/90">
                <div id="simulation-status" class="w-full text-center bg-indigo-900/40 p-3 rounded-lg border border-indigo-500/50 flex justify-between items-center mb-4 sticky top-0 z-30 backdrop-blur-sm">
                    </div>

                <div id="route-container" class="relative">
                    <div id="track-line" class="route-line bg-gray-700"></div>
                    <ul id="route-list" class="space-y-0 -ml-1"></ul>
                </div>

            </section>

        </div>
        <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 bg-indigo-500 text-white px-4 py-2 rounded-lg shadow-lg text-sm opacity-0 transition-opacity duration-300 z-50"></div>
    </div>

    <script type="module">

        const CONFIG = {
            DWELL_TIME_SECONDS: 25, INTERCHANGE_TIME_MINUTES: 5, FIRST_TRAIN_HOUR: 5, LAST_TRAIN_HOUR: 23,
            TIMETABLE: { weekday: { peak: 4, off_peak: 8 }, weekend: { peak: 6, off_peak: 10 } }
        };
        const precomputedData = { timeFromStart: {}, timeFromEnd: {}, distanceFromStart: {}, distanceFromEnd: {}, stations: {} };
        let simulationState = { isActive: false, journeyId: null, timeline: [], startTime: 0, animationFrameId: null, lastStationIndex: -1, locationWatcherId: null, lastLocationUpdateTime: 0 };
        let currentJourney = null;

        const translations = {
            en: {
                appName: "NammaRide", planYourTrip: "Plan Your Trip", selectStationsHint: "Select stations to see the fastest route.", startLiveJourney: "Start Live Journey",
                disclaimer: "Disclaimer: Timings and fare are estimates, please confirm at stations.",
                nextTrain: "Next Train", totalTime: "Total Time", estFare: "Est. Fare", minutes: "min", now: "Now",
                hr: "hr", route: "Route", interchange: "Interchange", stops: "Stop(s)",
                depart: "Depart", arrive: "Arrive", boardAt: "Board at", towards: "towards",
                changeTo: "Change to", atPlatform: "at Platform", walkingTime: "min walking time.",
                liveTracking: "Live Tracking", nextStop: "Next Stop", exitJourney: "Exit Journey",
                youHaveArrived: "You have arrived! üéâ", journeyComplete: "Journey complete.",
                outsideServiceHours: "Outside Service Hours: Next available train shown.",
                platform: "Platform",
                nonOfficialDisclaimer: "This is not an official BMRCL website.",
                feedbackPrompt: "For feedback, use:",
            },
            hi: {
                appName: "‡§®‡§Æ‡•ç‡§Æ‡§æ ‡§∞‡§æ‡§á‡§°", planYourTrip: "‡§Ö‡§™‡§®‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç", selectStationsHint: "‡§∏‡§¨‡§∏‡•á ‡§§‡•á‡§ú‡§º ‡§∞‡•Ç‡§ü ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§ö‡•Å‡§®‡•á‡§Ç‡•§", startLiveJourney: "‡§≤‡§æ‡§á‡§µ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
                disclaimer: "‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£: ‡§∏‡§Æ‡§Ø ‡§î‡§∞ ‡§ï‡§ø‡§∞‡§æ‡§Ø‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§π‡•à‡§Ç, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•ç‡§ü‡•á‡§∂‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç‡•§",
                nextTrain: "‡§Ö‡§ó‡§≤‡•Ä ‡§ü‡•ç‡§∞‡•á‡§®", totalTime: "‡§ï‡•Å‡§≤ ‡§∏‡§Æ‡§Ø", estFare: "‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§ï‡§ø‡§∞‡§æ‡§Ø‡§æ", minutes: "‡§Æ‡§ø‡§®‡§ü", now: "‡§Ö‡§≠‡•Ä",
                hr: "‡§ò‡§Ç‡§ü‡§æ", route: "‡§∞‡•Ç‡§ü", interchange: "‡§á‡§Ç‡§ü‡§∞‡§ö‡•á‡§Ç‡§ú", stops: "‡§∏‡•ç‡§ü‡•â‡§™",
                depart: "‡§™‡•ç‡§∞‡§∏‡•ç‡§•‡§æ‡§®", arrive: "‡§Ü‡§ó‡§Æ‡§®", boardAt: "‡§™‡§∞ ‡§ö‡§¢‡§º‡•á‡§Ç", towards: "‡§ï‡•Ä ‡§ì‡§∞",
                changeTo: "‡§™‡§∞ ‡§¨‡§¶‡§≤‡•á‡§Ç", atPlatform: "‡§™‡§∞ ‡§™‡•ç‡§≤‡•á‡§ü‡§´‡•â‡§∞‡•ç‡§Æ", walkingTime: "‡§Æ‡§ø‡§®‡§ü ‡§ö‡§≤‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø‡•§",
                liveTracking: "‡§≤‡§æ‡§á‡§µ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó", nextStop: "‡§Ö‡§ó‡§≤‡§æ ‡§∏‡•ç‡§ü‡•â‡§™", exitJourney: "‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡•á‡§Ç",
                youHaveArrived: "‡§Ü‡§™ ‡§™‡§π‡•Å‡§Ç‡§ö ‡§ó‡§è! üéâ", journeyComplete: "‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§™‡•Ç‡§∞‡•Ä ‡§π‡•Å‡§à‡•§",
                outsideServiceHours: "‡§∏‡•á‡§µ‡§æ ‡§ò‡§Ç‡§ü‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§π‡§∞: ‡§Ö‡§ó‡§≤‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ü‡•ç‡§∞‡•á‡§® ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§ó‡§à ‡§π‡•à‡•§",
                platform: "‡§™‡•ç‡§≤‡•á‡§ü‡§´‡•â‡§∞‡•ç‡§Æ",
                nonOfficialDisclaimer: "‡§Ø‡§π ‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§¨‡•Ä‡§è‡§Æ‡§Ü‡§∞‡§∏‡•Ä‡§è‡§≤ (BMRCL) ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§",
                feedbackPrompt: "‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç:",
            },
            kn: {
                appName: "‡≤®‡≤Æ‡≥ç‡≤Æ ‡≤∞‡≥à‡≤°‡≥ç", planYourTrip: "‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤Ø‡≥ã‡≤ú‡≤ø‡≤∏‡≤ø", selectStationsHint: "‡≤µ‡≥á‡≤ó‡≤¶ ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥ã‡≤°‡≤≤‡≥Å ‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤Ü‡≤∞‡≤ø‡≤∏‡≤ø.", startLiveJourney: "‡≤≤‡≥à‡≤µ‡≥ç ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø",
                disclaimer: "‡≤π‡≤ï‡≥ç‡≤ï‡≥Å‡≤§‡≥ç‡≤Ø‡≤æ‡≤ó: ‡≤∏‡≤Æ‡≤Ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¶‡≤∞ ‡≤Ö‡≤Ç‡≤¶‡≤æ‡≤ú‡≥Å, ‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤¶‡≥É‡≤¢‡≥Ä‡≤ï‡≤∞‡≤ø‡≤∏‡≤ø.",
                nextTrain: "‡≤Æ‡≥Å‡≤Ç‡≤¶‡≤ø‡≤® ‡≤∞‡≥à‡≤≤‡≥Å", totalTime: "‡≤í‡≤ü‡≥ç‡≤ü‡≥Å ‡≤∏‡≤Æ‡≤Ø", estFare: "‡≤Ö‡≤Ç‡≤¶‡≤æ‡≤ú‡≥Å ‡≤¶‡≤∞", minutes: "‡≤®‡≤ø‡≤Æ‡≤ø‡≤∑", now: "‡≤à‡≤ó",
                hr: "‡≤ó‡≤Ç‡≤ü‡≥Ü", route: "‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó", interchange: "‡≤á‡≤Ç‡≤ü‡≤∞‡≥ç‡≤ö‡≥á‡≤Ç‡≤ú‡≥ç", stops: "‡≤®‡≤ø‡≤≤‡≥Å‡≤ó‡≤°‡≥Ü‡≤ó‡≤≥‡≥Å",
                depart: "‡≤π‡≥ä‡≤∞‡≤°‡≤ø", arrive: "‡≤Ü‡≤ó‡≤Æ‡≤ø‡≤∏‡≤ø", boardAt: "‡≤π‡≤§‡≥ç‡≤§‡≤ø‡≤∞‡≤ø", towards: "‡≤ï‡≤°‡≥Ü‡≤ó‡≥Ü",
                changeTo: "‡≤ó‡≥Ü ‡≤¨‡≤¶‡≤≤‡≤æ‡≤Ø‡≤ø‡≤∏‡≤ø", atPlatform: "‡≤∞‡≤≤‡≥ç‡≤≤‡≤ø ‡≤™‡≥ç‡≤≤‡≤æ‡≤ü‡≥ç‚Äå‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç", walkingTime: "‡≤®‡≤ø‡≤Æ‡≤ø‡≤∑ ‡≤®‡≤°‡≤ø‡≤ó‡≥Ü ‡≤∏‡≤Æ‡≤Ø.",
                liveTracking: "‡≤≤‡≥à‡≤µ‡≥ç ‡≤ü‡≥ç‡≤∞‡≥ç‡≤Ø‡≤æ‡≤ï‡≤ø‡≤Ç‡≤ó‡≥ç", nextStop: "‡≤Æ‡≥Å‡≤Ç‡≤¶‡≤ø‡≤® ‡≤®‡≤ø‡≤≤‡≥Å‡≤ó‡≤°‡≥Ü", exitJourney: "‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£‡≤¶‡≤ø‡≤Ç‡≤¶ ‡≤®‡≤ø‡≤∞‡≥ç‡≤ó‡≤Æ‡≤ø‡≤∏‡≤ø",
                youHaveArrived: "‡≤®‡≥Ä‡≤µ‡≥Å ‡≤§‡≤≤‡≥Å‡≤™‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ä‡≤∞‡≤ø! üéâ", journeyComplete: "‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Æ‡≥Å‡≤ó‡≤ø‡≤¶‡≤ø‡≤¶‡≥Ü.",
                outsideServiceHours: "‡≤∏‡≥á‡≤µ‡≤æ ‡≤∏‡≤Æ‡≤Ø‡≤¶ ‡≤π‡≥ä‡≤∞‡≤ó‡≥Ü: ‡≤Æ‡≥Å‡≤Ç‡≤¶‡≤ø‡≤® ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤∞‡≥Å‡≤µ ‡≤∞‡≥à‡≤≤‡≥Å ‡≤§‡≥ã‡≤∞‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.",
                platform: "‡≤™‡≥ç‡≤≤‡≤æ‡≤ü‡≥ç‚Äå‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç",
                nonOfficialDisclaimer: "‡≤á‡≤¶‡≥Å ‡≤Ö‡≤ß‡≤ø‡≤ï‡≥É‡≤§ ‡≤¨‡≤ø‡≤é‡≤Ç‡≤Ü‡≤∞‡≥ç‚Äå‡≤∏‡≤ø‡≤é‡≤≤‡≥ç (BMRCL) ‡≤µ‡≥Ü‡≤¨‡≥ç‚Äå‡≤∏‡≥à‡≤ü‡≥ç ‡≤Ö‡≤≤‡≥ç‡≤≤.",
                feedbackPrompt: "‡≤™‡≥ç‡≤∞‡≤§‡≤ø‡≤ï‡≥ç‡≤∞‡≤ø‡≤Ø‡≥Ü‡≤ó‡≤æ‡≤ó‡≤ø, ‡≤¨‡≤≥‡≤∏‡≤ø:",
            }
        };

        const stationTranslations = {
            "Whitefield (Kadugodi)": { "hi": "‡§µ‡•ç‡§π‡§æ‡§á‡§ü‡§´‡•Ä‡§≤‡•ç‡§° (‡§ï‡§æ‡§°‡•Å‡§ó‡•ã‡§°‡•Ä)", "kn": "‡≤µ‡≥à‡≤ü‡≥ç‚Äå‡≤´‡≥Ä‡≤≤‡≥ç‡≤°‡≥ç (‡≤ï‡≤æ‡≤°‡≥Å‡≤ó‡≥ã‡≤°‡≤ø)" },
            "Hopefarm Channasandra": { "hi": "‡§π‡•ã‡§™‡§´‡§æ‡§∞‡•ç‡§Æ ‡§ö‡§®‡•ç‡§®‡§æ‡§∏‡§Ç‡§¶‡•ç‡§∞‡§æ", "kn": "‡≤π‡≥ã‡≤™‡≥ç‚Äå‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç ‡≤ö‡≤®‡≥ç‡≤®‡≤∏‡≤Ç‡≤¶‡≥ç‡≤∞" },
            "Kadugodi Tree Park": { "hi": "‡§ï‡§æ‡§°‡•Å‡§ó‡•ã‡§°‡•Ä ‡§ü‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§ï", "kn": "‡≤ï‡≤æ‡≤°‡≥Å‡≤ó‡≥ã‡≤°‡≤ø ‡≤ü‡≥ç‡≤∞‡≥Ä ‡≤™‡≤æ‡≤∞‡≥ç‡≤ï‡≥ç" },
            "Pattanduru Agrahara": { "hi": "‡§™‡§ü‡•ç‡§ü‡§Ç‡§¶‡•Å‡§∞‡•Å ‡§Ö‡§ó‡•ç‡§∞‡§π‡§æ‡§∞‡§æ", "kn": "‡≤™‡≤ü‡≥ç‡≤ü‡≤Ç‡≤¶‡≥Ç‡≤∞‡≥Å ‡≤Ö‡≤ó‡≥ç‡≤∞‡≤π‡≤æ‡≤∞" },
            "Sri Sathya Sai Hospital": { "hi": "‡§∂‡•ç‡§∞‡•Ä ‡§∏‡§§‡•ç‡§Ø ‡§∏‡§æ‡§à‡§Ç ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤", "kn": "‡≤∂‡≥ç‡≤∞‡≥Ä ‡≤∏‡≤§‡≥ç‡≤Ø ‡≤∏‡≤æ‡≤Ø‡≤ø ‡≤Ü‡≤∏‡≥ç‡≤™‡≤§‡≥ç‡≤∞‡≥Ü" },
            "Nallurhalli": { "hi": "‡§®‡§æ‡§≤‡•ç‡§≤‡•Ç‡§∞‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤®‡≤≤‡≥ç‡≤≤‡≥Ç‡≤∞‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Kundalahalli": { "hi": "‡§ï‡•Å‡§Ç‡§°‡§≤‡§æ‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤ï‡≥Å‡≤Ç‡≤°‡≤≤‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Seetharampalya": { "hi": "‡§∏‡•Ä‡§§‡§æ‡§∞‡§æ‡§Æ‡§™‡§æ‡§≤‡•ç‡§Ø‡§æ", "kn": "‡≤∏‡≥Ä‡≤§‡≤æ‡≤∞‡≤æ‡≤Æ‡≤™‡≤æ‡≤≥‡≥ç‡≤Ø" },
            "Hoodi": { "hi": "‡§π‡•Å‡§°‡•Ä", "kn": "‡≤π‡≥Ç‡≤°‡≤ø" },
            "Garudacharpalya": { "hi": "‡§ó‡§∞‡•Å‡§°‡§º‡§ö‡§∞‡§™‡§æ‡§≤‡•ç‡§Ø‡§æ", "kn": "‡≤ó‡≤∞‡≥Å‡≤°‡≤æ‡≤ö‡≤æ‡≤∞‡≥ç‡≤™‡≤æ‡≤≥‡≥ç‡≤Ø" },
            "Singayyanapalya": { "hi": "‡§∏‡§ø‡§Ç‡§ó‡§Ø‡•ç‡§Ø‡§æ‡§®‡§™‡§æ‡§≤‡•ç‡§Ø‡§æ", "kn": "‡≤∏‡≤ø‡≤Ç‡≤ó‡≤Ø‡≥ç‡≤Ø‡≤®‡≤™‡≤æ‡≤≥‡≥ç‡≤Ø" },
            "K.R. Puram": { "hi": "‡§ï‡•á.‡§Ü‡§∞. ‡§™‡•Å‡§∞‡§Æ", "kn": "‡≤ï‡≥Ü.‡≤Ü‡≤∞‡≥ç. ‡≤™‡≥Å‡≤∞‡≤Ç" },
            "Baiyappanahalli": { "hi": "‡§¨‡•à‡§Ø‡§™‡•ç‡§™‡§®‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤¨‡≥à‡≤Ø‡≤™‡≥ç‡≤™‡≤®‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Swami Vivekananda Road": { "hi": "‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§µ‡§ø‡§µ‡•á‡§ï‡§æ‡§®‡§Ç‡§¶ ‡§∞‡•ã‡§°", "kn": "‡≤∏‡≥ç‡≤µ‡≤æ‡≤Æ‡≤ø ‡≤µ‡≤ø‡≤µ‡≥á‡≤ï‡≤æ‡≤®‡≤Ç‡≤¶ ‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü" },
            "Indiranagar": { "hi": "‡§á‡§Ç‡§¶‡§ø‡§∞‡§æ‡§®‡§ó‡§∞", "kn": "‡≤á‡≤Ç‡≤¶‡≤ø‡≤∞‡≤æ‡≤®‡≤ó‡≤∞" },
            "Halasuru": { "hi": "‡§π‡§æ‡§≤‡§∏‡•Å‡§∞‡•Å", "kn": "‡≤π‡≤≤‡≤∏‡≥Ç‡≤∞‡≥Å" },
            "Trinity": { "hi": "‡§ü‡•ç‡§∞‡§ø‡§®‡§ø‡§ü‡•Ä", "kn": "‡≤ü‡≥ç‡≤∞‡≤ø‡≤®‡≤ø‡≤ü‡≤ø" },
            "M.G. Road": { "hi": "‡§è‡§Æ.‡§ú‡•Ä. ‡§∞‡•ã‡§°", "kn": "‡≤é‡≤Ç.‡≤ú‡≤ø. ‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü" },
            "Cubbon Park": { "hi": "‡§ï‡§¨‡•ç‡§¨‡§® ‡§™‡§æ‡§∞‡•ç‡§ï", "kn": "‡≤ï‡≤¨‡≥ç‡≤¨‡≤®‡≥ç ‡≤™‡≤æ‡≤∞‡≥ç‡≤ï‡≥ç" },
            "Nadaprabhu Kempegowda Stn., Majestic": { "hi": "‡§®‡§æ‡§°‡§™‡•ç‡§∞‡§≠‡•Å ‡§ï‡•á‡§Æ‡•ç‡§™‡•á‡§ó‡•å‡§°‡§º‡§æ ‡§∏‡•ç‡§ü‡•á‡§∂‡§®, ‡§Æ‡•á‡§ú‡•á‡§∏‡•ç‡§ü‡§ø‡§ï", "kn": "‡≤®‡≤æ‡≤°‡≤™‡≥ç‡≤∞‡≤≠‡≥Å ‡≤ï‡≥Ü‡≤Ç‡≤™‡≥á‡≤ó‡≥å‡≤° ‡≤®‡≤ø., ‡≤Æ‡≥Ü‡≤ú‡≥Ü‡≤∏‡≥ç‡≤ü‡≤ø‡≤ï‡≥ç" },
            "KSR City Railway Station": { "hi": "‡§ï‡•á‡§è‡§∏‡§Ü‡§∞ ‡§∏‡§ø‡§ü‡•Ä ‡§∞‡•á‡§≤‡§µ‡•á ‡§∏‡•ç‡§ü‡•á‡§∂‡§®", "kn": "‡≤ï‡≥Ü.‡≤é‡≤∏‡≥ç.‡≤Ü‡≤∞‡≥ç ‡≤∏‡≤ø‡≤ü‡≤ø ‡≤∞‡≥à‡≤≤‡≥ç‡≤µ‡≥Ü ‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£" },
            "Magadi Road": { "hi": "‡§Æ‡§ó‡§¶‡•Ä ‡§∞‡•ã‡§°", "kn": "‡≤Æ‡≤æ‡≤ó‡≤°‡≤ø ‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü" },
            "Hosahalli": { "hi": "‡§π‡•ã‡§∏‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤π‡≥ä‡≤∏‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Vijayanagar": { "hi": "‡§µ‡§ø‡§ú‡§Ø‡§®‡§ó‡§∞", "kn": "‡≤µ‡≤ø‡≤ú‡≤Ø‡≤®‡≤ó‡≤∞" },
            "Attiguppe": { "hi": "‡§Ö‡§§‡•ç‡§§‡§ø‡§ó‡•Å‡§™‡•ç‡§™‡•á", "kn": "‡≤Ö‡≤§‡≥ç‡≤§‡≤ø‡≤ó‡≥Å‡≤™‡≥ç‡≤™‡≥Ü" },
            "Deepanjali Nagar": { "hi": "‡§¶‡•Ä‡§™‡§æ‡§Ç‡§ú‡§≤‡§ø ‡§®‡§ó‡§∞", "kn": "‡≤¶‡≥Ä‡≤™‡≤æ‡≤Ç‡≤ú‡≤≤‡≤ø ‡≤®‡≤ó‡≤∞" },
            "Mysuru Road": { "hi": "‡§Æ‡•à‡§∏‡•Ç‡§∞‡•Å ‡§∞‡•ã‡§°", "kn": "‡≤Æ‡≥à‡≤∏‡≥Ç‡≤∞‡≥Å ‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü" },
            "Nayandahalli": { "hi": "‡§®‡§æ‡§Ø‡§Ç‡§°‡§æ‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤®‡≤æ‡≤Ø‡≤Ç‡≤°‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Rajarajeshwari Nagar": { "hi": "‡§∞‡§æ‡§ú‡§∞‡§æ‡§ú‡•á‡§∂‡•ç‡§µ‡§∞‡•Ä ‡§®‡§ó‡§∞", "kn": "‡≤∞‡≤æ‡≤ú‡≤∞‡≤æ‡≤ú‡≥á‡≤∂‡≥ç‡≤µ‡≤∞‡≤ø ‡≤®‡≤ó‡≤∞" },
            "Jnanabharathi": { "hi": "‡§ú‡•ç‡§û‡§æ‡§®‡§≠‡§æ‡§∞‡§§‡•Ä", "kn": "‡≤ú‡≥ç‡≤û‡≤æ‡≤®‡≤≠‡≤æ‡≤∞‡≤§‡≤ø" },
            "Pattanagere": { "hi": "‡§™‡§ü‡•ç‡§ü‡§®‡§ó‡•á‡§∞‡•á", "kn": "‡≤™‡≤ü‡≥ç‡≤ü‡≤£‡≤ó‡≥Ü‡≤∞‡≥Ü" },
            "Kengeri Bus Terminal": { "hi": "‡§ï‡•á‡§Ç‡§ó‡•á‡§∞‡•Ä ‡§¨‡§∏ ‡§ü‡§∞‡•ç‡§Æ‡§ø‡§®‡§≤", "kn": "‡≤ï‡≥Ü‡≤Ç‡≤ó‡≥á‡≤∞‡≤ø ‡≤¨‡≤∏‡≥ç ‡≤ü‡≤∞‡≥ç‡≤Æ‡≤ø‡≤®‡≤≤‡≥ç" },
            "Kengeri": { "hi": "‡§ï‡•á‡§Ç‡§ó‡•á‡§∞‡•Ä", "kn": "‡≤ï‡≥Ü‡≤Ç‡≤ó‡≥á‡≤∞‡≤ø" },
            "Challaghatta": { "hi": "‡§ö‡§≤‡•ç‡§≤‡§æ‡§ò‡§ü‡•ç‡§ü‡§æ", "kn": "‡≤ö‡≤≤‡≥ç‡≤≤‡≤ò‡≤ü‡≥ç‡≤ü" },
            "Madavara": { "hi": "‡§Æ‡§æ‡§¶‡§æ‡§µ‡§∞‡§æ", "kn": "‡≤Æ‡≤æ‡≤¶‡≤æ‡≤µ‡≤∞" },
            "Chikkabidarakallu": { "hi": "‡§ö‡§ø‡§ï‡•ç‡§ï‡§¨‡•Ä‡§°‡§∞‡§ï‡§≤‡•ç‡§≤‡•Å", "kn": "‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï‡≤¨‡≤ø‡≤¶‡≤∞‡≤ï‡≤≤‡≥ç‡≤≤‡≥Å" },
            "Manjunath Nagar": { "hi": "‡§Æ‡§Ç‡§ú‡•Å‡§®‡§æ‡§• ‡§®‡§ó‡§∞", "kn": "‡≤Æ‡≤Ç‡≤ú‡≥Å‡≤®‡≤æ‡≤• ‡≤®‡≤ó‡≤∞" },
            "Nagasandra": { "hi": "‡§®‡§æ‡§ó‡§∏‡§®‡•ç‡§¶‡•ç‡§∞‡§æ", "kn": "‡≤®‡≤æ‡≤ó‡≤∏‡≤Ç‡≤¶‡≥ç‡≤∞" },
            "Dasarahalli": { "hi": "‡§¶‡§æ‡§∏‡§∞‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤¶‡≤æ‡≤∏‡≤∞‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Jalahalli": { "hi": "‡§ú‡§æ‡§≤‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤ú‡≤æ‡≤≤‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Peenya Industry": { "hi": "‡§™‡•Ä‡§®‡•ç‡§Ø‡§æ ‡§á‡§Ç‡§°‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä", "kn": "‡≤™‡≥Ä‡≤£‡≥ç‡≤Ø‡≤æ ‡≤ï‡≥à‡≤ó‡≤æ‡≤∞‡≤ø‡≤ï‡≥Ü" },
            "Peenya": { "hi": "‡§™‡•Ä‡§®‡•ç‡§Ø‡§æ", "kn": "‡≤™‡≥Ä‡≤£‡≥ç‡≤Ø‡≤æ" },
            "Goraguntepalya": { "hi": "‡§ó‡•ã‡§∞‡§ó‡•Å‡§Ç‡§ü‡•á‡§™‡§æ‡§≤‡•ç‡§Ø‡§æ", "kn": "‡≤ó‡≥ä‡≤∞‡≤ó‡≥Å‡≤Ç‡≤ü‡≥Ü‡≤™‡≤æ‡≤≥‡≥ç‡≤Ø" },
            "Yeshwanthpur": { "hi": "‡§Ø‡§∂‡§µ‡§Ç‡§§‡§™‡•Å‡§∞", "kn": "‡≤Ø‡≤∂‡≤µ‡≤Ç‡≤§‡≤™‡≥Å‡≤∞" },
            "Sandal Soap Factory": { "hi": "‡§∏‡•à‡§Ç‡§°‡§≤ ‡§∏‡•ã‡§™ ‡§´‡•à‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä", "kn": "‡≤∏‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤°‡≤≤‡≥ç ‡≤∏‡≥ã‡≤™‡≥ç ‡≤ï‡≤æ‡≤∞‡≥ç‡≤ñ‡≤æ‡≤®‡≥Ü" },
            "Mahalakshmi": { "hi": "‡§Æ‡§π‡§æ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä", "kn": "‡≤Æ‡≤π‡≤æ‡≤≤‡≤ï‡≥ç‡≤∑‡≥ç‡≤Æ‡≤ø" },
            "Rajajinagar": { "hi": "‡§∞‡§æ‡§ú‡§æ‡§ú‡•Ä‡§®‡§ó‡§∞", "kn": "‡≤∞‡≤æ‡≤ú‡≤æ‡≤ú‡≤ø‡≤®‡≤ó‡≤∞" },
            "Mahakavi Kuvempu Road": { "hi": "‡§Æ‡§π‡§æ‡§ï‡§µ‡§ø ‡§ï‡•Å‡§µ‡•á‡§Ç‡§™‡•Å ‡§∞‡•ã‡§°", "kn": "‡≤Æ‡≤π‡≤æ‡≤ï‡≤µ‡≤ø ‡≤ï‡≥Å‡≤µ‡≥Ü‡≤Ç‡≤™‡≥Å ‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü" },
            "Srirampura": { "hi": "‡§∂‡•ç‡§∞‡•Ä‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞‡§æ", "kn": "‡≤∂‡≥ç‡≤∞‡≥Ä‡≤∞‡≤æ‡≤Æ‡≤™‡≥Å‡≤∞" },
            "Mantri Square Sampige Road": { "hi": "‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§∏‡•ç‡§ï‡•ç‡§µ‡§æ‡§Ø‡§∞ ‡§∏‡§Ç‡§™‡§ø‡§ó‡•á ‡§∞‡•ã‡§°", "kn": "‡≤Æ‡≤Ç‡≤§‡≥ç‡≤∞‡≤ø ‡≤∏‡≥ç‡≤ï‡≥ç‡≤µ‡≥á‡≤∞‡≥ç ‡≤∏‡≤Ç‡≤™‡≤ø‡≤ó‡≥Ü ‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü" },
            "Chickpete": { "hi": "‡§ö‡§ø‡§ï‡§™‡•á‡§ü", "kn": "‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï‡≤™‡≥á‡≤ü‡≥Ü" },
            "Krishna Rajendra Market": { "hi": "‡§ï‡•É‡§∑‡•ç‡§£‡§æ ‡§∞‡§æ‡§ú‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü", "kn": "‡≤ï‡≥É‡≤∑‡≥ç‡≤£ ‡≤∞‡≤æ‡≤ú‡≥á‡≤Ç‡≤¶‡≥ç‡≤∞ ‡≤Æ‡≤æ‡≤∞‡≥Å‡≤ï‡≤ü‡≥ç‡≤ü‡≥Ü" },
            "National College": { "hi": "‡§®‡•á‡§∂‡§®‡§≤ ‡§ï‡•â‡§≤‡•á‡§ú", "kn": "‡≤®‡≥ç‡≤Ø‡≤æ‡≤∑‡≤®‡≤≤‡≥ç ‡≤ï‡≤æ‡≤≤‡≥á‡≤ú‡≥Å" },
            "Lalbagh Botanical Garden": { "hi": "‡§≤‡§æ‡§≤‡§¨‡§æ‡§ó ‡§¨‡•â‡§ü‡§®‡§ø‡§ï‡§≤ ‡§ó‡§æ‡§∞‡•ç‡§°‡§®", "kn": "‡≤≤‡≤æ‡≤≤‡≥ç ‡≤¨‡≤æ‡≤ó‡≥ç ‡≤¨‡≥ä‡≤ü‡≤æ‡≤®‡≤ø‡≤ï‡≤≤‡≥ç ‡≤ó‡≤æ‡≤∞‡≥ç‡≤°‡≤®‡≥ç" },
            "South End Circle": { "hi": "‡§∏‡§æ‡§â‡§• ‡§è‡§Ç‡§° ‡§∏‡§∞‡•ç‡§ï‡§≤", "kn": "‡≤∏‡≥å‡≤§‡≥ç ‡≤é‡≤Ç‡≤°‡≥ç ‡≤∏‡≤∞‡≥ç‡≤ï‡≤≤‡≥ç" },
            "Jayanagar": { "hi": "‡§ú‡§Ø‡§®‡§ó‡§∞", "kn": "‡≤ú‡≤Ø‡≤®‡≤ó‡≤∞" },
            "Rashtreeya Vidyalaya Road": { "hi": "‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø‡§æ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§∞‡•ã‡§°", "kn": "‡≤∞‡≤æ‡≤∑‡≥ç‡≤ü‡≥ç‡≤∞‡≥Ä‡≤Ø ‡≤µ‡≤ø‡≤¶‡≥ç‡≤Ø‡≤æ‡≤≤‡≤Ø ‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü" },
            "Banashankari": { "hi": "‡§¨‡§®‡§∂‡§Ç‡§ï‡§∞‡•Ä", "kn": "‡≤¨‡≤®‡≤∂‡≤Ç‡≤ï‡≤∞‡≤ø" },
            "Jayaprakash Nagar": { "hi": "‡§ú‡§Ø‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§®‡§ó‡§∞", "kn": "‡≤ú‡≤Ø‡≤™‡≥ç‡≤∞‡≤ï‡≤æ‡≤∂ ‡≤®‡≤ó‡≤∞" },
            "Yelachenahalli": { "hi": "‡§Ø‡•á‡§≤‡§æ‡§ö‡•á‡§®‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤Ø‡≤≤‡≤ö‡≥á‡≤®‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Konankunte Cross": { "hi": "‡§ï‡•ã‡§®‡§®‡§ï‡•Ç‡§Ç‡§§‡•á ‡§ï‡•ç‡§∞‡•â‡§∏", "kn": "‡≤ï‡≥ã‡≤®‡≤®‡≤ï‡≥Å‡≤Ç‡≤ü‡≥Ü ‡≤ï‡≥ç‡≤∞‡≤æ‡≤∏‡≥ç" },
            "Doddakallasandra": { "hi": "‡§¶‡•ã‡§°‡•ç‡§°‡§ï‡§≤‡•ç‡§≤‡§æ‡§∏‡§®‡•ç‡§¶‡•ç‡§∞‡§æ", "kn": "‡≤¶‡≥ä‡≤°‡≥ç‡≤°‡≤ï‡≤≤‡≥ç‡≤≤‡≤∏‡≤Ç‡≤¶‡≥ç‡≤∞" },
            "Vajarahalli": { "hi": "‡§µ‡§ú‡•ç‡§∞‡§æ‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤µ‡≤ú‡≥ç‡≤∞‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Talaghattapura": { "hi": "‡§§‡§æ‡§≤‡§ò‡§ü‡•ç‡§ü‡§™‡•Å‡§∞‡§æ", "kn": "‡≤§‡≤≤‡≤ò‡≤ü‡≥ç‡≤ü‡≤™‡≥Å‡≤∞" },
            "Silk Institute": { "hi": "‡§∏‡§ø‡§≤‡•ç‡§ï ‡§á‡§Ç‡§∏‡•ç‡§ü‡•Ä‡§ü‡•ç‡§Ø‡•Ç‡§ü", "kn": "‡≤∏‡≤ø‡≤≤‡≥ç‡≤ï‡≥ç ‡≤á‡≤®‡≥ç‚Äå‡≤∏‡≥ç‡≤ü‡≤ø‡≤ü‡≥ç‡≤Ø‡≥Ç‡≤ü‡≥ç" },
            "Ragigudda": { "hi": "‡§∞‡§æ‡§ó‡§ø‡§ó‡•Å‡§°‡•ç‡§°‡§æ", "kn": "‡≤∞‡≤æ‡≤ó‡≤ø‡≤ó‡≥Å‡≤°‡≥ç‡≤°" },
            "Jayadeva Hospital": { "hi": "‡§ú‡§Ø‡§¶‡•á‡§µ‡§æ ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤", "kn": "‡≤ú‡≤Ø‡≤¶‡≥á‡≤µ ‡≤Ü‡≤∏‡≥ç‡≤™‡≤§‡≥ç‡≤∞‡≥Ü" },
            "BTM Layout": { "hi": "‡§¨‡•Ä‡§ü‡•Ä‡§è‡§Æ ‡§≤‡•á‡§Ü‡§â‡§ü", "kn": "‡≤¨‡≤ø‡≤ü‡≤ø‡≤é‡≤Ç ‡≤≤‡≥á‡≤î‡≤ü‡≥ç" },
            "Central Silk Board": { "hi": "‡§∏‡•á‡§Ç‡§ü‡•ç‡§∞‡§≤ ‡§∏‡§ø‡§≤‡•ç‡§ï ‡§¨‡•ã‡§∞‡•ç‡§°", "kn": "‡≤∏‡≥Ü‡≤Ç‡≤ü‡≥ç‡≤∞‡≤≤‡≥ç ‡≤∏‡≤ø‡≤≤‡≥ç‡≤ï‡≥ç ‡≤¨‡≥ã‡≤∞‡≥ç‡≤°‡≥ç" },
            "Bommanahalli": { "hi": "‡§¨‡•ã‡§Æ‡•ç‡§Æ‡§®‡§π‡§≤‡•ç‡§≤‡•Ä", "kn": "‡≤¨‡≥ä‡≤Æ‡≥ç‡≤Æ‡≤®‡≤π‡≤≥‡≥ç‡≤≥‡≤ø" },
            "Hongasandra": { "hi": "‡§π‡•ã‡§Ç‡§ó‡§æ‡§∏‡§®‡•ç‡§¶‡•ç‡§∞‡§æ", "kn": "‡≤π‡≥ä‡≤Ç‡≤ó‡≤∏‡≤Ç‡≤¶‡≥ç‡≤∞" },
            "Kudlu Gate": { "hi": "‡§ï‡•Å‡§°‡§≤‡•Å ‡§ó‡•á‡§ü", "kn": "‡≤ï‡≥Å‡≤°‡≥ç‡≤≤‡≥Å ‡≤ó‡≥á‡≤ü‡≥ç" },
            "Singasandra": { "hi": "‡§∏‡§ø‡§Ç‡§ó‡§æ‡§∏‡§®‡•ç‡§¶‡•ç‡§∞‡§æ", "kn": "‡≤¨‡≥Ü‡≤Ç‡≤ó‡≤≥‡≥Ç‡≤∞‡≥Å ‡≤∏‡≤ø‡≤Ç‡≤ó‡≤∏‡≤Ç‡≤¶‡≥ç‡≤∞" },
            "Hosa Road": { "hi": "‡§π‡•ã‡§∏‡§æ ‡§∞‡•ã‡§°", "kn": "‡≤π‡≥ã‡≤∏ ‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü" },
            "Beratena Agrahara": { "hi": "‡§¨‡•á‡§∞‡§ü‡•á‡§®‡§æ ‡§Ö‡§ó‡•ç‡§∞‡§π‡§æ‡§∞‡§æ", "kn": "‡≤¨‡≥á‡≤∞‡≤ü‡≥Ü‡≤®‡≤æ ‡≤Ö‡≤ó‡≥ç‡≤∞‡≤π‡≤æ‡≤∞" },
            "Electronic City": { "hi": "‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•â‡§®‡§ø‡§ï ‡§∏‡§ø‡§ü‡•Ä", "kn": "‡≤é‡≤≤‡≥Ü‡≤ï‡≥ç‡≤ü‡≥ç‡≤∞‡≤æ‡≤®‡≤ø‡≤ï‡≥ç ‡≤∏‡≤ø‡≤ü‡≤ø" },
            "Infosys Foundation Konappana Agrahara": { "hi": "‡§á‡§®‡•ç‡§´‡•ã‡§∏‡§ø‡§∏ ‡§´‡§æ‡§â‡§Ç‡§°‡•á‡§∂‡§® ‡§ï‡•ã‡§®‡§™‡•ç‡§™‡§®‡§æ ‡§Ö‡§ó‡•ç‡§∞‡§π‡§æ‡§∞‡§æ", "kn": "‡≤á‡≤®‡≥ç‡≤´‡≥ã‡≤∏‡≤ø‡≤∏‡≥ç ‡≤´‡≥å‡≤Ç‡≤°‡≥á‡≤∂‡≤®‡≥ç ‡≤ï‡≥ä‡≤®‡≤™‡≥ç‡≤™‡≤® ‡≤Ö‡≤ó‡≥ç‡≤∞‡≤π‡≤æ‡≤∞" },
            "Huskur Road": { "hi": "‡§π‡•Å‡§∏‡•ç‡§ï‡•Å‡§∞ ‡§∞‡•ã‡§°", "kn": "‡≤π‡≥Å‡≤∏‡≥ç‡≤ï‡≥Ç‡≤∞‡≥Å ‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü" },
            "Hebbagodi": { "hi": "‡§π‡•á‡§¨‡•ç‡§¨‡§æ‡§ó‡•å‡§°‡§º‡•Ä", "kn": "‡≤π‡≥Ü‡≤¨‡≥ç‡≤¨‡≤ó‡≥ã‡≤°‡≤ø" },
            "Bommasandra": { "hi": "‡§¨‡•ã‡§Æ‡•ç‡§Æ‡§æ‡§∏‡§®‡•ç‡§¶‡•ç‡§∞‡§æ", "kn": "‡≤¨‡≥ä‡≤Æ‡≥ç‡≤Æ‡≤∏‡≤Ç‡≤¶‡≥ç‡≤∞" },
            // Line Names 
            "Purple Line": { "hi": "‡§™‡§∞‡•ç‡§™‡§≤ ‡§≤‡§æ‡§á‡§®", "kn": "‡≤®‡≥á‡≤∞‡≤≥‡≥Ü ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó" },
            "Green Line": { "hi": "‡§ó‡•ç‡§∞‡•Ä‡§® ‡§≤‡§æ‡§á‡§®", "kn": "‡≤π‡≤∏‡≤ø‡≤∞‡≥Å ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó" },
            "Yellow Line": { "hi": "‡§Ø‡•á‡§≤‡•ã ‡§≤‡§æ‡§á‡§®", "kn": "‡≤π‡≤≥‡≤¶‡≤ø ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó" },
        };
        
        const lineNameMap = { 
            "Purple Line": "Purple Line",
            "Green Line": "Green Line",
            "Yellow Line": "Yellow Line"
        };

        function T_STATION(stationName) {
            
            if (lineNameMap[stationName] && currentLang !== 'en') {
                return stationTranslations[stationName][currentLang] || stationName;
            }
            

            if (currentLang !== 'en' && stationTranslations[stationName] && stationTranslations[stationName][currentLang]) {
                return stationTranslations[stationName][currentLang];
            }
            return stationName;
        }


        //  DATA (English names maintained for lookup IDs, translations handled by T_STATION) 
        const metroData = {
            purple: { name: "Purple Line", color: "#8B5CF6", stations: [
                { id: "P01", name: "Whitefield (Kadugodi)", lat: 12.9904, lon: 77.7615, timeToNext: 110, distanceToNext: 2.1, platforms: { forward: 2, backward: 1 } },
                { id: "P02", name: "Hopefarm Channasandra", lat: 12.9897, lon: 77.7479, timeToNext: 85, distanceToNext: 1.8, platforms: { forward: 2, backward: 1 } },
                { id: "P03", name: "Kadugodi Tree Park", lat: 12.9863, lon: 77.7397, timeToNext: 75, distanceToNext: 1.0, platforms: { forward: 2, backward: 1 } },
                { id: "P04", name: "Pattanduru Agrahara", lat: 12.9829, lon: 77.7324, timeToNext: 70, distanceToNext: 0.9, platforms: { forward: 2, backward: 1 } },
                { id: "P05", name: "Sri Sathya Sai Hospital", lat: 12.9806, lon: 77.7248, timeToNext: 80, distanceToNext: 1.1, platforms: { forward: 2, backward: 1 } },
                { id: "P06", name: "Nallurhalli", lat: 12.9765, lon: 77.7175, timeToNext: 70, distanceToNext: 0.9, platforms: { forward: 2, backward: 1 } },
                { id: "P07", name: "Kundalahalli", lat: 12.9715, lon: 77.7126, timeToNext: 85, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "P08", name: "Seetharampalya", lat: 12.9768, lon: 77.7027, timeToNext: 75, distanceToNext: 1.0, platforms: { forward: 2, backward: 1 } },
                { id: "P09", name: "Hoodi", lat: 12.9845, lon: 77.6963, timeToNext: 80, distanceToNext: 1.3, platforms: { forward: 2, backward: 1 } },
                { id: "P10", name: "Garudacharpalya", lat: 12.9907, lon: 77.6917, timeToNext: 80, distanceToNext: 1.6, platforms: { forward: 2, backward: 1 } },
                { id: "P11", name: "Singayyanapalya", lat: 12.9936, lon: 77.6828, timeToNext: 105, distanceToNext: 1.5, platforms: { forward: 2, backward: 1 } },
                { id: "P12", name: "K.R. Puram", lat: 12.9959, lon: 77.6718, timeToNext: 130, distanceToNext: 2.2, platforms: { forward: 2, backward: 1 } },
                { id: "P13", name: "Baiyappanahalli", lat: 12.9951, lon: 77.6521, timeToNext: 105, distanceToNext: 1.8, platforms: { forward: 2, backward: 1 } },
                { id: "P14", name: "Swami Vivekananda Road", lat: 12.9918, lon: 77.6393, timeToNext: 80, distanceToNext: 1.9, platforms: { forward: 2, backward: 1 } },
                { id: "P15", name: "Indiranagar", lat: 12.9781, lon: 77.6406, timeToNext: 95, distanceToNext: 1.4, platforms: { forward: 2, backward: 1 } },
                { id: "P16", name: "Halasuru", lat: 12.9781, lon: 77.6276, timeToNext: 90, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "P17", name: "Trinity", lat: 12.9733, lon: 77.6181, timeToNext: 80, distanceToNext: 1.1, platforms: { forward: 2, backward: 1 } },
                { id: "P18", name: "M.G. Road", lat: 12.9756, lon: 77.6083, timeToNext: 105, distanceToNext: 1.4, platforms: { forward: 2, backward: 1 } },
                { id: "P19", name: "Cubbon Park", lat: 12.9794, lon: 77.5959, timeToNext: 120, distanceToNext: 2.1, platforms: { forward: 2, backward: 1 } },
                { id: "P20", name: "Nadaprabhu Kempegowda Stn., Majestic", lat: 12.9761, lon: 77.5731, timeToNext: 105, distanceToNext: 1.1, interchange: true, interchangeId: 'majestic', platforms: { forward: 2, backward: 1 } },
                { id: "P21", name: "KSR City Railway Station", lat: 12.9718, lon: 77.5670, timeToNext: 115, distanceToNext: 1.6, platforms: { forward: 2, backward: 1 } },
                { id: "P22", name: "Magadi Road", lat: 12.9782, lon: 77.5542, timeToNext: 130, distanceToNext: 1.3, platforms: { forward: 2, backward: 1 } },
                { id: "P23", name: "Hosahalli", lat: 12.9701, lon: 77.5459, timeToNext: 95, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "P24", name: "Vijayanagar", lat: 12.9613, lon: 77.5372, timeToNext: 90, distanceToNext: 1.1, platforms: { forward: 2, backward: 1 } },
                { id: "P25", name: "Attiguppe", lat: 12.9567, lon: 77.5298, timeToNext: 100, distanceToNext: 0.8, platforms: { forward: 2, backward: 1 } },
                { id: "P26", name: "Deepanjali Nagar", lat: 12.9496, lon: 77.5262, timeToNext: 100, distanceToNext: 0.9, platforms: { forward: 2, backward: 1 } },
                { id: "P27", name: "Mysuru Road", lat: 12.9442, lon: 77.5212, timeToNext: 130, distanceToNext: 2.0, platforms: { forward: 2, backward: 1 } },
                { id: "P28", name: "Nayandahalli", lat: 12.9348, lon: 77.5147, timeToNext: 105, distanceToNext: 1.1, platforms: { forward: 2, backward: 1 } },
                { id: "P29", name: "Rajarajeshwari Nagar", lat: 12.9269, lon: 77.5104, timeToNext: 110, distanceToNext: 1.0, platforms: { forward: 2, backward: 1 } },
                { id: "P30", name: "Jnanabharathi", lat: 12.9213, lon: 77.5015, timeToNext: 105, distanceToNext: 1.5, platforms: { forward: 2, backward: 1 } },
                { id: "P31", name: "Pattanagere", lat: 12.9108, lon: 77.4975, timeToNext: 80, distanceToNext: 1.1, platforms: { forward: 2, backward: 1 } },
                { id: "P32", name: "Kengeri Bus Terminal", lat: 12.9034, lon: 77.4878, timeToNext: 90, distanceToNext: 1.3, platforms: { forward: 2, backward: 1 } },
                { id: "P33", name: "Kengeri", lat: 12.9064, lon: 77.4767, timeToNext: 95, distanceToNext: 1.4, platforms: { forward: 2, backward: 1 } },
                { id: "P34", name: "Challaghatta", lat: 12.9056, lon: 77.4619, timeToNext: 0, distanceToNext: 0, platforms: { forward: 2, backward: 1 } }
            ] },
            green: { name: "Green Line", color: "#22C55E", stations: [
                { id: "G01", name: "Madavara", lat: 13.0645, lon: 77.5218, timeToNext: 90, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "G02", name: "Chikkabidarakallu", lat: 13.0537, lon: 77.5141, timeToNext: 105, distanceToNext: 1.8, platforms: { forward: 2, backward: 1 } },
                { id: "G03", name: "Manjunath Nagar", lat: 13.0428, lon: 77.5102, timeToNext: 95, distanceToNext: 1.5, platforms: { forward: 2, backward: 1 } },
                { id: "G04", name: "Nagasandra", lat: 13.0401, lon: 77.5191, timeToNext: 95, distanceToNext: 1.5, platforms: { forward: 2, backward: 1 } },
                { id: "G05", name: "Dasarahalli", lat: 13.0336, lon: 77.5297, timeToNext: 90, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "G06", name: "Jalahalli", lat: 13.0315, lon: 77.5401, timeToNext: 100, distanceToNext: 1.1, platforms: { forward: 2, backward: 1 } },
                { id: "G07", name: "Peenya Industry", lat: 13.0298, lon: 77.5492, timeToNext: 90, distanceToNext: 1.0, platforms: { forward: 2, backward: 1 } },
                { id: "G08", name: "Peenya", lat: 13.0253, lon: 77.5562, timeToNext: 105, distanceToNext: 1.4, platforms: { forward: 2, backward: 1 } },
                { id: "G09", name: "Goraguntepalya", lat: 13.0169, lon: 77.5539, timeToNext: 110, distanceToNext: 0.9, platforms: { forward: 2, backward: 1 } },
                { id: "G10", name: "Yeshwanthpur", lat: 13.0229, lon: 77.5501, timeToNext: 105, distanceToNext: 1.5, platforms: { forward: 2, backward: 1 } },
                { id: "G11", name: "Sandal Soap Factory", lat: 13.0118, lon: 77.5516, timeToNext: 95, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "G12", name: "Mahalakshmi", lat: 13.0031, lon: 77.5508, timeToNext: 80, distanceToNext: 0.6, platforms: { forward: 2, backward: 1 } },
                { id: "G13", name: "Rajajinagar", lat: 12.9961, lon: 77.5518, timeToNext: 75, distanceToNext: 0.5, platforms: { forward: 2, backward: 1 } },
                { id: "G14", name: "Mahakavi Kuvempu Road", lat: 12.9922, lon: 77.5583, timeToNext: 100, distanceToNext: 1.8, platforms: { forward: 2, backward: 1 } },
                { id: "G15", name: "Srirampura", lat: 12.9868, lon: 77.5621, timeToNext: 85, distanceToNext: 0.7, platforms: { forward: 2, backward: 1 } },
                { id: "G16", name: "Mantri Square Sampige Road", lat: 12.9904, lon: 77.5714, timeToNext: 90, distanceToNext: 1.3, platforms: { forward: 2, backward: 1 } },
                { id: "G17", name: "Nadaprabhu Kempegowda Stn., Majestic", lat: 12.9761, lon: 77.5731, timeToNext: 115, distanceToNext: 0.9, interchange: true, interchangeId: 'majestic', platforms: { forward: 4, backward: 3 } },
                { id: "G18", name: "Chickpete", lat: 12.9698, lon: 77.5756, timeToNext: 90, distanceToNext: 0.9, platforms: { forward: 2, backward: 1 } },
                { id: "G19", name: "Krishna Rajendra Market", lat: 12.9625, lon: 77.5784, timeToNext: 85, distanceToNext: 0.8, platforms: { forward: 2, backward: 1 } },
                { id: "G20", name: "National College", lat: 12.9554, lon: 77.5739, timeToNext: 80, distanceToNext: 0.4, platforms: { forward: 2, backward: 1 } },
                { id: "G21", name: "Lalbagh Botanical Garden", lat: 12.9497, lon: 77.5796, timeToNext: 105, distanceToNext: 1.3, platforms: { forward: 2, backward: 1 } },
                { id: "G22", name: "South End Circle", lat: 12.9398, lon: 77.5815, timeToNext: 95, distanceToNext: 1.0, platforms: { forward: 2, backward: 1 } },
                { id: "G23", name: "Jayanagar", lat: 12.9308, lon: 77.5808, timeToNext: 110, distanceToNext: 0.8, platforms: { forward: 2, backward: 1 } },
                { id: "G24", name: "Rashtreeya Vidyalaya Road", lat: 12.9221, lon: 77.5830, timeToNext: 95, distanceToNext: 0.9, interchange: true, interchangeId: 'rv_road', platforms: { forward: 2, backward: 1 } },
                { id: "G25", name: "Banashankari", lat: 12.9158, lon: 77.5727, timeToNext: 105, distanceToNext: 1.8, platforms: { forward: 2, backward: 1 } },
                { id: "G26", name: "Jayaprakash Nagar", lat: 12.9069, lon: 77.5714, timeToNext: 95, distanceToNext: 0.8, platforms: { forward: 2, backward: 1 } },
                { id: "G27", name: "Yelachenahalli", lat: 12.8996, lon: 77.5684, timeToNext: 80, distanceToNext: 1.1, platforms: { forward: 2, backward: 1 } },
                { id: "G28", name: "Konankunte Cross", lat: 12.8893, lon: 77.5663, timeToNext: 85, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "G29", name: "Doddakallasandra", lat: 12.8801, lon: 77.5638, timeToNext: 95, distanceToNext: 1.3, platforms: { forward: 2, backward: 1 } },
                { id: "G30", name: "Vajarahalli", lat: 12.8718, lon: 77.5612, timeToNext: 75, distanceToNext: 0.9, platforms: { forward: 2, backward: 1 } },
                { id: "G31", name: "Talaghattapura", lat: 12.8614, lon: 77.5583, timeToNext: 90, distanceToNext: 1.4, platforms: { forward: 2, backward: 1 } },
                { id: "G32", name: "Silk Institute", lat: 12.8504, lon: 77.5552, timeToNext: 0, distanceToNext: 0, platforms: { forward: 2, backward: 1 } }
            ] },
            yellow: { name: "Yellow Line", color: "#FBBF24", stations: [
                { id: "Y01", name: "Rashtreeya Vidyalaya Road", lat: 12.9221, lon: 77.5830, timeToNext: 90, distanceToNext: 1.1, interchange: true, interchangeId: 'rv_road', platforms: { forward: 3, backward: 1 }},
                { id: "Y02", name: "Ragigudda", lat: 12.9174, lon: 77.5898, timeToNext: 80, distanceToNext: 1.0, platforms: { forward: 2, backward: 1 } },
                { id: "Y03", name: "Jayadeva Hospital", lat: 12.9175, lon: 77.6006, timeToNext: 95, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "Y04", name: "BTM Layout", lat: 12.9165, lon: 77.6105, timeToNext: 85, distanceToNext: 0.9, platforms: { forward: 2, backward: 1 } },
                { id: "Y05", name: "Central Silk Board", lat: 12.9173, lon: 77.6254, timeToNext: 110, distanceToNext: 1.5, platforms: { forward: 2, backward: 1 } },
                { id: "Y06", name: "Bommanahalli", lat: 12.9048, lon: 77.6295, timeToNext: 80, distanceToNext: 0.8, platforms: { forward: 2, backward: 1 } },
                { id: "Y07", name: "Hongasandra", lat: 12.8981, lon: 77.6338, timeToNext: 90, distanceToNext: 1.0, platforms: { forward: 2, backward: 1 } },
                { id: "Y08", name: "Kudlu Gate", lat: 12.8903, lon: 77.6402, timeToNext: 95, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "Y09", name: "Singasandra", lat: 12.8824, lon: 77.6465, timeToNext: 80, distanceToNext: 0.9, platforms: { forward: 2, backward: 1 } },
                { id: "Y10", name: "Hosa Road", lat: 12.8751, lon: 77.6521, timeToNext: 105, distanceToNext: 1.4, platforms: { forward: 2, backward: 1 } },
                { id: "Y11", name: "Beratena Agrahara", lat: 12.8662, lon: 77.6599, timeToNext: 90, distanceToNext: 1.1, platforms: { forward: 2, backward: 1 } },
                { id: "Y12", name: "Electronic City", lat: 12.8533, lon: 77.6659, timeToNext: 120, distanceToNext: 1.8, platforms: { forward: 2, backward: 1 } },
                { id: "Y13", name: "Infosys Foundation Konappana Agrahara", lat: 12.8430, lon: 77.6698, timeToNext: 80, distanceToNext: 1.0, platforms: { forward: 2, backward: 1 } },
                { id: "Y14", name: "Huskur Road", lat: 12.8351, lon: 77.6742, timeToNext: 95, distanceToNext: 1.2, platforms: { forward: 2, backward: 1 } },
                { id: "Y15", name: "Hebbagodi", lat: 12.8259, lon: 77.6791, timeToNext: 105, distanceToNext: 1.5, platforms: { forward: 2, backward: 1 } },
                { id: "Y16", name: "Bommasandra", lat: 12.8139, lon: 77.6845, timeToNext: 0, distanceToNext: 0, platforms: { forward: 2, backward: 1 } },
            ] }
        };

        
        function getCurrentSimulatedDate() { return new Date(); }
        function precomputeJourneyData() { 
            for (const lineKey in metroData) {
                const line = metroData[lineKey];
                line.stations.forEach((s, index) => {
                    precomputedData.stations[s.id] = { ...s, lineKey, lineName: line.name, color: line.color, index };
                });
                let cumulativeTimeF = 0, cumulativeDistanceF = 0;
                precomputedData.timeFromStart[line.stations[0].id] = 0;
                precomputedData.distanceFromStart[line.stations[0].id] = 0;
                for (let i = 0; i < line.stations.length - 1; i++) {
                    cumulativeTimeF += (line.stations[i].timeToNext + CONFIG.DWELL_TIME_SECONDS);
                    cumulativeDistanceF += line.stations[i].distanceToNext;
                    precomputedData.timeFromStart[line.stations[i + 1].id] = cumulativeTimeF;
                    precomputedData.distanceFromStart[line.stations[i + 1].id] = cumulativeDistanceF;
                }
                let cumulativeTimeB = 0, cumulativeDistanceB = 0;
                const lastStationId = line.stations[line.stations.length - 1].id;
                precomputedData.timeFromEnd[lastStationId] = 0;
            precomputedData.distanceFromEnd[lastStationId] = 0;
                for (let i = line.stations.length - 1; i > 0; i--) {
                    cumulativeTimeB += (line.stations[i - 1].timeToNext + CONFIG.DWELL_TIME_SECONDS);
                    cumulativeDistanceB += line.stations[i - 1].distanceToNext;
                    precomputedData.timeFromEnd[line.stations[i - 1].id] = cumulativeTimeB;
                    precomputedData.distanceFromEnd[line.stations[i - 1].id] = cumulativeDistanceB;
                }
            }
        }
        function calculateSingleLineJourney(start, end) {
            const lineStations = metroData[start.lineKey].stations;
            const direction = start.index < end.index ? 'forward' : 'backward';
            const timeData = (direction === 'forward') ? precomputedData.timeFromStart : precomputedData.timeFromEnd;
            const distanceData = (direction === 'forward') ? precomputedData.distanceFromStart : precomputedData.distanceFromEnd;
            const totalTime = Math.abs(timeData[end.id] - timeData[start.id]);
            const totalDistance = Math.abs(distanceData[end.id] - distanceData[start.id]);
            const path = (direction === 'forward' ? lineStations.slice(start.index, end.index + 1) : lineStations.slice(end.index, start.index + 1).reverse()).map(s => precomputedData.stations[s.id]);
            const journeyDirectionName = (direction === 'forward') ? T_STATION(lineStations[lineStations.length - 1].name) : T_STATION(lineStations[0].name);
            return { stations: path, time: totalTime, distance: totalDistance, direction, journeyDirectionName, startPlatform: start.platforms[direction], endPlatform: end.platforms[direction === 'forward' ? 'backward' : 'forward'] };
        }
        function calculateJourney(startId, endId) {
            if (startId === endId) return null;
            const startStation = precomputedData.stations[startId];
            const endStation = precomputedData.stations[endId];
            const interchangePenalty = CONFIG.INTERCHANGE_TIME_MINUTES * 60;
            let bestPath = null;
            if (startStation.lineKey === endStation.lineKey) {
                bestPath = [calculateSingleLineJourney(startStation, endStation)];
            } else {
                const commonInterchanges = Object.values(precomputedData.stations).filter(s => s.interchange && (s.lineKey === startStation.lineKey || s.lineKey === endStation.lineKey)).reduce((acc, s) => { acc[s.interchangeId] = (acc[s.interchangeId] || 0) + 1; return acc; }, {});
                const possibleInterchangeId = Object.keys(commonInterchanges).find(id => commonInterchanges[id] === 2);
                if (possibleInterchangeId) {
                    const interchangeStartLine = findStationByInterchangeId(possibleInterchangeId, startStation.lineKey);
                    const interchangeEndLine = findStationByInterchangeId(possibleInterchangeId, endStation.lineKey);
                    const part1 = calculateSingleLineJourney(startStation, interchangeStartLine);
                    const part2 = calculateSingleLineJourney(interchangeEndLine, endStation);
                    bestPath = [part1, part2];
                } else {
                    if ((startStation.lineKey === 'purple' && endStation.lineKey === 'yellow')) {
                        const majesticPurple = findStationByInterchangeId('majestic', 'purple');
                        const majesticGreen = findStationByInterchangeId('majestic', 'green');
                        const rvRoadGreen = findStationByInterchangeId('rv_road', 'green');
                        const rvRoadYellow = findStationByInterchangeId('rv_road', 'yellow');
                        bestPath = [calculateSingleLineJourney(startStation, majesticPurple), calculateSingleLineJourney(majesticGreen, rvRoadGreen), calculateSingleLineJourney(rvRoadYellow, endStation)];
                    } else if ((startStation.lineKey === 'yellow' && endStation.lineKey === 'purple')) {
                        const rvRoadYellow = findStationByInterchangeId('rv_road', 'yellow');
                        const rvRoadGreen = findStationByInterchangeId('rv_road', 'green');
                        const majesticGreen = findStationByInterchangeId('majestic', 'green');
                        const majesticPurple = findStationByInterchangeId('majestic', 'purple');
                        bestPath = [calculateSingleLineJourney(startStation, rvRoadYellow), calculateSingleLineJourney(rvRoadGreen, majesticGreen), calculateSingleLineJourney(majesticPurple, endStation)];
                    }
                }
            }
            if (!bestPath) return { error: "No route found." };
            let totalTime = bestPath.reduce((sum, part) => sum + part.time, 0) + Math.max(0, bestPath.length - 1) * interchangePenalty;
            const totalDistance = bestPath.reduce((sum, part) => sum + part.distance, 0);
            const totalFare = calculateFare(totalDistance);
            const firstTrainInfo = getNextDeparture(startId, bestPath[0].direction);
            return { id: `${startId}-${endId}`, parts: bestPath, totalTime, totalFare, ...firstTrainInfo, interchanges: bestPath.length - 1, totalStops: bestPath.reduce((sum, p) => sum + p.stations.length, 0) - bestPath.length };
        }
        function findStationByInterchangeId(interchangeId, lineKey) { return Object.values(precomputedData.stations).find(s => s.interchangeId === interchangeId && s.lineKey === lineKey); }
        function getDynamicFrequency() {
            const now = getCurrentSimulatedDate(); 
            const day = now.getDay(); 
            const hour = now.getHours();
            const isWeekday = day >= 1 && day <= 5;
            let baseFrequency = isWeekday ? ((hour >= 8 && hour < 11) || (hour >= 17 && hour < 20) ? CONFIG.TIMETABLE.weekday.peak : CONFIG.TIMETABLE.weekday.off_peak) : (hour >= 11 && hour < 21 ? CONFIG.TIMETABLE.weekend.peak : CONFIG.TIMETABLE.weekend.off_peak);
            return baseFrequency;
        }
        function getNextDeparture(stationId, direction) {
            const now = getCurrentSimulatedDate();
            const minutesPastMidnight = now.getHours() * 60 + now.getMinutes();
            const firstTrainTime = CONFIG.FIRST_TRAIN_HOUR * 60; const lastTrainTime = CONFIG.LAST_TRAIN_HOUR * 60;
            let timeFromTerminal = (direction === 'forward') ? precomputedData.timeFromStart[stationId] : precomputedData.timeFromEnd[stationId];
            const timeFromTerminalMinutes = Math.ceil(timeFromTerminal / 60);
            const firstDepartureAtStation = firstTrainTime + timeFromTerminalMinutes;
            let isOutsideServiceHours = false; let nextDeparture;
            if (minutesPastMidnight < firstDepartureAtStation) {
                isOutsideServiceHours = true; nextDeparture = firstDepartureAtStation;
            } else {
                const frequencyMinutes = getDynamicFrequency();
                const timeSinceFirstDeparture = minutesPastMidnight - firstDepartureAtStation;
                const trainsMissed = Math.floor(timeSinceFirstDeparture / frequencyMinutes);
                const lastDeparture = firstDepartureAtStation + trainsMissed * frequencyMinutes;
                nextDeparture = lastDeparture + frequencyMinutes;
                if (nextDeparture > lastTrainTime + timeFromTerminalMinutes + 10) {
                    isOutsideServiceHours = true; nextDeparture = firstDepartureAtStation + 24 * 60;
                }
            }
            const waitMinutes = Math.ceil(nextDeparture - minutesPastMidnight);
            const departureTime = new Date(now);
            departureTime.setMinutes(departureTime.getMinutes() + waitMinutes);
            return { departureTime, waitMinutes, isOutsideServiceHours };
        }
        function calculateFare(distance) {
            distance = Math.round(distance * 10) / 10;
            if (distance <= 2) return 10;
            if (distance <= 4) return 20;
            if (distance <= 6) return 30;
            if (distance <= 8) return 40;
            if (distance <= 10) return 50;
            if (distance <= 12) return 60;
            if (distance <= 20) return 70;
            if (distance <= 25) return 80;
            return 90;
        }
        function haversineDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; const dLat = (lat2 - lat1) * Math.PI / 180; const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }
        function generateTimeline(journey) {
            const timeline = [];
            let currentTime = 0;
            journey.parts.forEach((part, partIndex) => {
                part.stations.forEach((station, stationIndex) => {
                    if (partIndex > 0 || stationIndex > 0) {
                        const isInterchangeHop = stationIndex === 0 && partIndex > 0;
                        if (isInterchangeHop) {
                            currentTime += CONFIG.INTERCHANGE_TIME_MINUTES * 60;
                        } else {
                            const prevStationData = part.stations[stationIndex - 1];
                            currentTime += prevStationData.timeToNext + CONFIG.DWELL_TIME_SECONDS;
                        }
                    }
                    const arrivalTime = currentTime;
                    const departureTime = currentTime; 
                
                    timeline.push({ stationId: station.id, stationName: T_STATION(station.name), arrivalTime, departureTime });
                });
            });
            return timeline;
        }

        let currentLang = localStorage.getItem('appLang') || 'en';

        function T(key) { return translations[currentLang][key] || translations['en'][key]; }

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('appLang', lang);
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                el.textContent = T(el.getAttribute('data-lang-key'));
            });
            

            populateDropdowns();

            if (!simulationState.isActive) handleJourneyUpdate();
            lucide.createIcons();
        }

        function switchView(viewId) {
            document.getElementById('planner-view').classList.add('hidden');
            document.getElementById('map-view').classList.add('hidden');
            document.getElementById(viewId).classList.remove('hidden');
            document.querySelector('.max-w-lg').classList.toggle('h-full', viewId === 'map-view');
            document.querySelector('.max-w-lg').classList.toggle('sm:h-auto', viewId === 'planner-view');
            
            const langSelector = document.getElementById('language-selector');
            langSelector.disabled = viewId === 'map-view';
            langSelector.classList.toggle('opacity-50', viewId === 'map-view');
        }

        function formatTime(date) { return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true }); }
        
        function formatTravelTime(minutes) {
            if (minutes < 60) return `${minutes} ${T('minutes')}`;
            const hours = Math.floor(minutes / 60); const remainingMinutes = minutes % 60;
            if (remainingMinutes === 0) return `${hours} ${T('hr')}`;
            return `${hours} ${T('hr')} ${remainingMinutes} ${T('minutes')}`;
        }
        
        function populateDropdowns() {
            const startSelect = document.getElementById('start-station'); 
            const endSelect = document.getElementById('end-station');
            
            const savedStart = startSelect.value;
            const savedEnd = endSelect.value;
            
            startSelect.innerHTML = `<option value="" disabled>${T('planYourTrip')}</option>`;
            endSelect.innerHTML = `<option value="" disabled>${T('planYourTrip')}</option>`;
            
            ['purple', 'green', 'yellow'].forEach(lineKey => {
                const line = metroData[lineKey]; 
                const optgroup = document.createElement('optgroup');
                
                optgroup.label = T_STATION(line.name); 
                
                line.stations.forEach(station => {
                    const option = document.createElement('option'); 
                    option.value = station.id; 
                    
                    option.textContent = T_STATION(station.name); 
                    optgroup.appendChild(option);
                });
                startSelect.appendChild(optgroup.cloneNode(true)); 
                endSelect.appendChild(optgroup.cloneNode(true));
            });
            
            startSelect.value = savedStart || 'P20';
            endSelect.value = savedEnd || 'G24';
        
            if (!savedStart) startSelect.options[0].selected = true;
            if (!savedEnd) endSelect.options[0].selected = true;
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message; toast.style.opacity = 1;
            setTimeout(() => { toast.style.opacity = 0; }, 3000);
        }

        function stopSimulation() {
            if (simulationState.animationFrameId) cancelAnimationFrame(simulationState.animationFrameId);
            if (simulationState.locationWatcherId) {
                navigator.geolocation.clearWatch(simulationState.locationWatcherId);
            }
            sessionStorage.removeItem('activeJourney');
            sessionStorage.removeItem('simulationState');

            simulationState = { isActive: false, journeyId: null, timeline: [], startTime: 0, animationFrameId: null, lastStationIndex: -1, locationWatcherId: null, lastLocationUpdateTime: 0 };
            
            const trainMarker = document.getElementById('train-marker');
            if(trainMarker) trainMarker.remove();
            
            switchView('planner-view');
            
            document.getElementById('board-train-btn').classList.remove('hidden');
            handleJourneyUpdate();
        }
        
        function displayJourneyResult(journey) {
            currentJourney = journey; 
            const summaryDiv = document.getElementById('journey-summary');
            const button = document.getElementById('board-train-btn');
            
            if (!journey || journey.error) {
                summaryDiv.innerHTML = `<p class="text-yellow-400">${journey?.error || T('selectStationsHint')}</p>`;
                button.classList.add('hidden');
                return;
            }

            const totalMinutes = Math.ceil(journey.totalTime / 60);
            const totalJourneyTime = totalMinutes + journey.waitMinutes;
            
            summaryDiv.innerHTML = `
                <div class="grid grid-cols-3 gap-3 text-center text-white">
                    <div>
                        <p class="text-xs text-gray-400 mb-0.5" data-lang-key="nextTrain">${T('nextTrain')}</p>
                        <p class="font-bold text-lg text-indigo-300">${journey.waitMinutes <= 1 ? T('now') : journey.waitMinutes + ' ' + T('minutes')}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-400 mb-0.5" data-lang-key="totalTime">${T('totalTime')}</p>
                        <p class="font-bold text-lg">${formatTravelTime(totalJourneyTime)}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-400 mb-0.5" data-lang-key="estFare">${T('estFare')}</p>
                        <p class="font-bold text-lg text-green-300">‚Çπ${journey.totalFare}</p>
                    </div>
                </div>
                ${journey.isOutsideServiceHours ? `<p class="text-xs text-amber-300 mt-3 font-semibold">${T('outsideServiceHours')}</p>` : ''}
                <p class="text-xs text-gray-500 mt-3">${T('route')}: ${journey.interchanges} ${T('interchange')}(s), ${journey.totalStops} ${T('stops')}</p>
            `;
            button.classList.remove('hidden');
            document.querySelector('#board-train-btn span').textContent = T('startLiveJourney');

            if (simulationState.isActive && simulationState.journeyId === journey.id) {
                button.classList.add('hidden');
                switchView('map-view');
            }
        }

        function renderLiveRoute(journey) {
            const routeList = document.getElementById('route-list');
            let routeHtml = ''; let overallStationIndex = 0;
            const totalMinutes = Math.ceil(journey.totalTime / 60);
            const finalArrivalTime = new Date(journey.departureTime.getTime() + totalMinutes * 60000);

            journey.parts.forEach((part, partIndex) => {
                const nextPart = journey.parts[partIndex + 1];
                
                let nextPartLineName = '';
                let nextPartJourneyDirectionName = '';
                if(nextPart) {
                     
                     nextPartLineName = T_STATION(nextPart.stations[0].lineName);
                     nextPartJourneyDirectionName = nextPart.journeyDirectionName;
                }

                part.stations.forEach((s, i) => {
                    const isLastPart = partIndex === journey.parts.length - 1;
                    const isFirstStationOfJourney = partIndex === 0 && i === 0;
                    const isLastStationOfJourney = isLastPart && i === part.stations.length - 1;
                    const isInterchangeAlight = !isLastPart && i === part.stations.length - 1;

                    routeHtml += renderStation(s, {
                        isStart: isFirstStationOfJourney, isEnd: isLastStationOfJourney, isInterchange: isInterchangeAlight,
                        startPlatform: part.startPlatform, 
                        journeyDirectionName: part.journeyDirectionName,
                        departureTime: journey.departureTime, 
                        arrivalTime: finalArrivalTime,
                        interchangeDetails: nextPart ? {
                            startPlatform: nextPart.startPlatform,
                            lineName: nextPartLineName,
                            journeyDirectionName: nextPartJourneyDirectionName
                        } : null,
                    }, overallStationIndex++);
                });
            });
            routeList.innerHTML = routeHtml;

            const routeContainer = document.getElementById('route-container');
            const trackLine = document.getElementById('track-line');
            setTimeout(() => {
                 trackLine.style.height = `${routeList.offsetHeight}px`;
            }, 50);

            if(!document.getElementById('train-marker')) {
                const trainMarker = document.createElement('div');
                trainMarker.id = 'train-marker';
                trainMarker.className = 'absolute left-[2px] z-20 transition-all duration-300'; 
                trainMarker.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 drop-shadow-lg text-indigo-400"><path d="M5 12.5L7.5 5H16.5L19 12.5L18 15.5H6L5 12.5Z" fill="currentColor"/><path d="M9.5 15.5H14.5L15 18H9L9.5 15.5Z" fill="currentColor"/></svg>`;
                routeContainer.prepend(trainMarker);
            }

            lucide.createIcons();
        }

        function renderStation(station, details, overallStationIndex) {
            const { isStart, isEnd, isInterchange, startPlatform, journeyDirectionName, departureTime, arrivalTime, interchangeDetails } = details;
            
            const translatedStationName = T_STATION(station.name);
            
            let platformInfo = '', timeLabel = '', timeValue = '';

            if (isStart) {
                timeLabel = T('depart'); timeValue = formatTime(departureTime);
                platformInfo = `<div class="text-xs mt-1 text-indigo-300 font-medium">${T('boardAt')} <b>${T('platform')} ${startPlatform}</b> ${T('towards')} <b>${journeyDirectionName}</b></div>`;
            } else if (isEnd) {
                timeLabel = T('arrive'); timeValue = formatTime(arrivalTime);
            }

            let interchangeBlock = '';
            if (isInterchange && interchangeDetails) {
                interchangeBlock = `
                <div class="my-3 p-3 text-xs font-semibold text-yellow-200 bg-yellow-900/40 border-l-4 border-yellow-500 rounded-r-md">
                    <p class="flex items-center gap-2"><i data-lucide="shuffle" class="w-4 h-4 flex-shrink-0 text-yellow-300"></i>
                    <span>${T('changeTo')} <b>${interchangeDetails.lineName}</b> ${T('atPlatform')} ${interchangeDetails.startPlatform} ${T('towards')} <b>${interchangeDetails.journeyDirectionName}</b>.</span></p>
                    <p class="text-gray-400 mt-1">~${CONFIG.INTERCHANGE_TIME_MINUTES} ${T('walkingTime')}</p>
                </div>`;
            }

            return `
                <li id="station-li-${overallStationIndex}" class="flex space-x-4 mb-4 pt-1 pb-1 relative z-10">
                    <div class="relative flex flex-col items-center ml-0">
                        <div class="h-5 w-5 rounded-full flex items-center justify-center shrink-0 station-marker-dot" style="background-color: ${station.color}; border: 3px solid #0F172A;">
                            <div class="h-1.5 w-1.5 bg-white/80 rounded-full"></div>
                        </div>
                    </div>
                    <div class="flex-grow pt-0.5">
                        <div class="flex items-center justify-between">
                            <p class="font-bold text-white text-base">${translatedStationName}</p>
                            ${timeValue ? `<div class="text-right"><p class="text-xs text-gray-500">${timeLabel}</p><p class="font-medium text-sm text-white">${timeValue}</p></div>` : ''}
                        </div>
                        ${platformInfo}${interchangeBlock}
                    </div>
                </li>`;
        }

        function updateClock() { document.getElementById('live-clock').textContent = getCurrentSimulatedDate().toLocaleTimeString('en-IN', { timeStyle: 'medium', hour12: true }); }
        function handleJourneyUpdate() { 
            const startStationSelect = document.getElementById('start-station');
            const endStationSelect = document.getElementById('end-station');
            
            if (!startStationSelect.value || !endStationSelect.value) {
                displayJourneyResult(null);
                return;
            }

            localStorage.setItem('startStationId', startStationSelect.value);
            localStorage.setItem('endStationId', endStationSelect.value);
            
            const journey = calculateJourney(startStationSelect.value, endStationSelect.value); 
            displayJourneyResult(journey); 
        }

        function requestLocationAndStart(journey) {
            if (!journey) return;
            const startSim = (useLiveLocation) => startSimulation(journey, useLiveLocation);
            if (!navigator.geolocation) {
                showToast("Geolocation is not supported. Using time-based simulation.");
                startSim(false);
                return;
            }
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    showToast("Location access granted. Starting live tracking.");
                    startSim(true);
                },
                (error) => {
                    showToast("Location denied. Starting time-based journey.");
                    startSim(false);
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        }
        function handleLocationUpdate(position) {
            const now = Date.now();
            if (now - simulationState.lastLocationUpdateTime < 8000) return;
            simulationState.lastLocationUpdateTime = now;
            const { latitude, longitude } = position.coords;
            let closestPointIndex = -1; let minDistance = Infinity;
            simulationState.timeline.forEach((point, index) => {
                const stationData = precomputedData.stations[point.stationId];
                const distance = haversineDistance(latitude, longitude, stationData.lat, stationData.lon);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestPointIndex = index;
                }
            });
            if (closestPointIndex !== -1 && closestPointIndex >= simulationState.lastStationIndex) {
                   const timeOffset = simulationState.timeline[closestPointIndex].arrivalTime;
                   simulationState.startTime = Date.now() - (timeOffset * 1000);
                   sessionStorage.setItem('simulationState', JSON.stringify({ startTime: simulationState.startTime, journeyId: simulationState.journeyId, useLiveLocation: true }));
            }
        }
        function handleLocationError(error) {
            console.warn(`Geolocation Error: ${error.message}`);
            showToast("Live location tracking lost.");
            if (simulationState.locationWatcherId) {
                navigator.geolocation.clearWatch(simulationState.locationWatcherId);
                simulationState.locationWatcherId = null;
            }
        }
        function startSimulation(journey, useLiveLocation, startTimeOverride) {
            if (!journey) return;
            switchView('map-view');
            simulationState.isActive = true;
            simulationState.journeyId = journey.id;
            simulationState.startTime = startTimeOverride || Date.now();
            simulationState.timeline = generateTimeline(journey);
            simulationState.lastStationIndex = -1;
            sessionStorage.setItem('activeJourney', JSON.stringify(journey));
            sessionStorage.setItem('simulationState', JSON.stringify({ startTime: simulationState.startTime, journeyId: journey.id, useLiveLocation: useLiveLocation }));
            renderLiveRoute(journey);
            
            const simStatus = document.getElementById('simulation-status');
            simStatus.innerHTML = `
                <div>
                    <p class="font-bold text-indigo-300 text-left flex items-center gap-2"><span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span></span>${T('liveTracking')}</p>
                    <p class="text-xs text-gray-400 mt-1 text-left">${T('nextStop')}: <span id="next-station-name" class="font-medium text-white">...</span></p>
                </div>
                <button id="exit-journey-btn" class="bg-red-500/80 text-white font-bold px-3 py-1.5 rounded-md text-xs hover:bg-red-500 transition-colors">${T('exitJourney')}</button>`;
            document.getElementById('exit-journey-btn').addEventListener('click', stopSimulation);

            if (useLiveLocation && navigator.geolocation && simulationState.locationWatcherId === null) {
                simulationState.locationWatcherId = navigator.geolocation.watchPosition(
                    handleLocationUpdate, handleLocationError, 
                    { enableHighAccuracy: true, maximumAge: 5000, timeout: 10000 }
                );
            }
            simulationState.animationFrameId = requestAnimationFrame(updateSimulation);
        }
        function updateSimulation() {
            if (!simulationState.isActive) return;
            const elapsedTime = (Date.now() - simulationState.startTime) / 1000;
            const timeline = simulationState.timeline;
            let currentSegmentIndex = -1;
            for(let i=0; i < timeline.length - 1; i++) {
                if (elapsedTime >= timeline[i].departureTime && elapsedTime < timeline[i+1].arrivalTime) {
                    currentSegmentIndex = i; break;
                }
            }
            const trainMarker = document.getElementById('train-marker');
            if (!trainMarker) { stopSimulation(); return; }
            let currentStationIndex = -1;
            for (let i = timeline.length - 1; i >= 0; i--) {
                if (elapsedTime >= timeline[i].arrivalTime) {
                    currentStationIndex = i; break;
                }
            }
            if (currentStationIndex !== -1) {
                const stationElement = document.getElementById(`station-li-${currentStationIndex}`);
                if(simulationState.lastStationIndex !== currentStationIndex) {
                    stationElement?.querySelector('.station-marker-dot')?.classList.add('station-pulse');
                    setTimeout(() => {
                        stationElement?.querySelector('.station-marker-dot')?.classList.remove('station-pulse');
                    }, 1000);
                    simulationState.lastStationIndex = currentStationIndex;
                }
                const nextStationNameEl = document.getElementById('next-station-name');
                if (nextStationNameEl) nextStationNameEl.textContent = timeline[currentStationIndex + 1]?.stationName || T('nextStop');
            }
            if (currentSegmentIndex !== -1) {
                const startSegment = timeline[currentSegmentIndex];
                const endSegment = timeline[currentSegmentIndex + 1];
                const startElement = document.getElementById(`station-li-${currentSegmentIndex}`);
                const endElement = document.getElementById(`station-li-${currentSegmentIndex + 1}`);
                if (startElement && endElement) {
                    const segmentDuration = endSegment.arrivalTime - startSegment.departureTime;
                    const timeIntoSegment = elapsedTime - startSegment.departureTime;
                    const progress = Math.min(timeIntoSegment / segmentDuration, 1);
                    const startY = startElement.offsetTop;
                    const endY = endElement.offsetTop;
                    trainMarker.style.top = `${startY + (endY - startY) * progress}px`;
                }
            } else if (currentStationIndex !== -1) {
                const stationElement = document.getElementById(`station-li-${currentStationIndex}`);
                if(stationElement) trainMarker.style.top = `${stationElement.offsetTop}px`;
            }
            if (elapsedTime >= timeline[timeline.length - 1].arrivalTime) {
                const simStatus = document.getElementById('simulation-status');
                if (simStatus) {
                       simStatus.innerHTML = `
                            <div>
                                <p class="font-bold text-green-400 text-left">${T('youHaveArrived')}</p>
                                <p class="text-xs text-gray-400 mt-1 text-left">${T('journeyComplete')}</p>
                            </div>
                            <button id="exit-journey-btn" class="bg-red-500/80 text-white font-bold px-3 py-1.5 rounded-md text-xs hover:bg-red-500 transition-colors">${T('exitJourney')}</button>
                    `;
                    document.getElementById('exit-journey-btn').addEventListener('click', stopSimulation);
                }
                if (simulationState.animationFrameId) cancelAnimationFrame(simulationState.animationFrameId);
                if (simulationState.locationWatcherId) navigator.geolocation.clearWatch(simulationState.locationWatcherId);
                const lastElement = document.getElementById(`station-li-${timeline.length - 1}`);
                if(trainMarker && lastElement) trainMarker.style.top = `${lastElement.offsetTop}px`;
            } else {
                simulationState.animationFrameId = requestAnimationFrame(updateSimulation);
            }
        }
        
       
        function initializeApp() {
            
            document.getElementById('language-selector').value = currentLang;
           
            setLanguage(currentLang); 
            
            document.getElementById('language-selector').addEventListener('change', (e) => {
                setLanguage(e.target.value);
            });

            precomputeJourneyData(); 
            
            const startSelect = document.getElementById('start-station'); 
            const endSelect = document.getElementById('end-station'); 
            const swapButton = document.getElementById('swap-stations');
            
            swapButton.addEventListener('click', () => { 
                if (simulationState.isActive) return;
                const temp = startSelect.value; startSelect.value = endSelect.value; endSelect.value = temp; 
                handleJourneyUpdate(); 
            });
            startSelect.addEventListener('change', handleJourneyUpdate); 
            endSelect.addEventListener('change', handleJourneyUpdate);
            document.getElementById('board-train-btn').addEventListener('click', () => {
                if (currentJourney) requestLocationAndStart(currentJourney);
            });
            
            const savedJourneyJSON = sessionStorage.getItem('activeJourney');
            const savedSimStateJSON = sessionStorage.getItem('simulationState');

            if (savedJourneyJSON && savedSimStateJSON) {
                const savedJourney = JSON.parse(savedJourneyJSON);
                const savedSimState = JSON.parse(savedSimStateJSON);
                savedJourney.departureTime = new Date(savedJourney.departureTime);
                startSelect.value = savedJourney.id.split('-')[0];
                endSelect.value = savedJourney.id.split('-')[1];
                startSimulation(savedJourney, savedSimState.useLiveLocation, savedSimState.startTime);
            } else {
                handleJourneyUpdate();
                switchView('planner-view');
            }

            updateClock(); 
            setInterval(updateClock, 1000); 
            setInterval(() => { if (!simulationState.isActive) handleJourneyUpdate(); }, 30000);
            
            lucide.createIcons();
        }

        initializeApp();
    </script>
</body>
</html>

